{% load static %}
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}OdontoIA{% endblock %}</title>

    <!-- CSS global -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'clinic/css/clinic.css' %}">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <link rel="icon" href="{% static 'img/logo_odontoIA.png' %}" type="image/png">
</head>

<body>
    <!-- Navbar (tema igual ao admin_custom.css) -->
    <header class="navbar">
        <div class="logo-container">
            <img src="{% static 'img/logo_odontoIA.png' %}" alt="Logo OdontoIA" class="logo">
        </div>
        <!-- Bot√£o hamburguer (s√≥ aparece no mobile) -->
        <button class="menu-toggle" id="menuToggle" aria-label="Abrir menu">
            ‚ò∞
        </button>

        <!-- Links de navega√ß√£o -->
        <nav class="nav-links" id="navMenu">
            <a href="{% url 'clinic:dashboard' %}">üè† Dashboard</a>
            <a href="{% url 'clinic:procedimentos_list' %}">ü¶∑ Procedimentos</a>
            <a href="{% url 'clinic:pacientes_list' %}">üë®‚Äç‚öïÔ∏è Pacientes</a>
            <a href="{% url 'clinic:consultas_list' %}">üóíÔ∏è Consultas</a>
            <a href="{% url 'clinic:consultas_calendar' %}">üìÖ Calend√°rio</a>

            <!-- üî• Financeiro: profissional OU premium -->
            {% if trial and trial.tipo == 'profissional' or trial.tipo == 'premium' %}
            <a href="#">üí∞ Financeiro</a>
            {% endif %}


            <!-- üî• IA & Insights: apenas premium -->
            {% if trial and trial.tipo == "premium" %}
            <a href="#">üß† IA & Insights</a>
            {% endif %}

            {% if user.is_authenticated %}
            <a href="{% url 'clinic:logout' %}" class="logout-link">Sair</a>
            {% else %}
            <a href="{% url 'clinic:login' %}" class="login-link">Entrar</a>
            {% endif %}
        </nav>

    </header>
    {% if user.is_authenticated and trial %}
    {% if trial.expirada %}
    <div class="alert alert-danger d-flex align-items-center justify-content-between mt-3 mx-3" role="alert">
        <div>
            üö´ <strong>Assinatura expirada.</strong>
            Seu per√≠odo de teste terminou
            {% if trial.fim_teste %}
            em {{ trial.fim_teste|date:"d/m/Y" }}
            {% endif %}.
        </div>
        <div>
            <a href="https://odontoia.codertec.com.br" target="_blank" class="btn btn-sm btn-light">Ver planos</a>
        </div>
    </div>

    {% elif trial.ativo and trial.dias_restantes and trial.dias_restantes <= 3 %} <div
        class="alert alert-warning d-flex align-items-center justify-content-between mt-3 mx-3" role="alert">
        <div>
            ‚è≥ <strong>Aten√ß√£o!</strong>
            Seu per√≠odo de teste termina em
            <strong>
                {{ trial.dias_restantes }} dia{% if trial.dias_restantes != 1 %}s{% endif %}
            </strong>.
        </div>
        <div>
            <a href="{% url 'clinic:criar_pagamento' 'basico' %}" class="btn btn-sm btn-primary">Assinar B√°sico</a>
            <a href="{% url 'clinic:criar_pagamento' 'profissional' %}" class="btn btn-sm btn-warning">Assinar
                Profissional</a>
            <a href="{% url 'clinic:criar_pagamento' 'premium' %}" class="btn btn-sm btn-dark">Assinar Premium</a>
        </div>
        </div>
        {% endif %}
        {% endif %}


        <!-- Conte√∫do -->
        <main class="main-content">
            {% block content %}{% endblock %}
        </main>

        <!-- Rodap√© -->
        <footer class="footer">
            <p>¬© {{ now|date:"Y" }} OdontoIA - Intelig√™ncia Odontol√≥gica</p>
        </footer>


        <style>
            #chatbot-container {
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 280px;
                background: #fff;
                border-radius: 12px;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                font-family: 'Segoe UI';
                border: 1px solid #ddd;
                z-index: 1000;
            }

            #chatbot-header {
                background: #0b5394;
                color: white;
                padding: 10px;
                font-weight: bold;
            }

            #chatbot-messages {
                height: 200px;
                overflow-y: auto;
                padding: 10px;
                font-size: 0.9rem;
            }

            #chatbot-input {
                border: none;
                border-top: 1px solid #ddd;
                padding: 8px;
                outline: none;
            }

            .toast-container {
                z-index: 11000;
                /* acima do chat */
            }
        </style>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const toggleBtn = document.getElementById("menuToggle");
                const navMenu = document.getElementById("navMenu");

                if (toggleBtn && navMenu) {
                    toggleBtn.addEventListener("click", function () {
                        navMenu.classList.toggle("active");
                    });
                }
            });
        </script>

        <style>
            /* Estilo para menu responsivo */
            .menu-toggle {
                display: none;
                background: none;
                border: none;
                font-size: 26px;
                cursor: pointer;
                color: #0b5394;
            }

            @media (max-width: 768px) {
                .menu-toggle {
                    display: block;
                }

                .nav-links {
                    display: none;
                    flex-direction: column;
                    background: #fff;
                    position: absolute;
                    top: 60px;
                    right: 10px;
                    border-radius: 10px;
                    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
                    padding: 10px;
                    z-index: 9999;
                }

                .nav-links.active {
                    display: flex;
                }

                .nav-links a {
                    padding: 8px 12px;
                    text-decoration: none;
                    color: #0b5394;
                    border-radius: 8px;
                }

                .nav-links a:hover {
                    background: #e8f0fe;
                }
            }

            /* üîπ Ajusta o layout dos bot√µes de planos */
            .alert .btn {
                margin-left: 5px;
            }

            @media (max-width: 768px) {
                .alert .d-flex {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 15px;
                }

                .alert .btn {
                    width: 100%;
                    margin: 4px 0;
                }
            }
        </style>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script src="{% static 'js/chat_odontoia.js' %}"></script>

        <!-- Toasts para mensagens Django -->
        <div aria-live="polite" aria-atomic="true" class="position-relative">
            <div class="toast-container position-fixed top-0 end-0 p-3">
                {% for message in messages %}
                <div class="toast align-items-center text-bg-{% if message.tags %}{{ message.tags }}{% else %}info{% endif %} border-0 mb-2"
                    role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="4000">
                    <div class="d-flex">
                        <div class="toast-body">
                            {{ message }}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                            aria-label="Fechar"></button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const toastElList = [].slice.call(document.querySelectorAll('.toast'))
                toastElList.forEach(toastEl => {
                    const toast = new bootstrap.Toast(toastEl)
                    toast.show()
                })
            })
        </script>

</body>

</html>
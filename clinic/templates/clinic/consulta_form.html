{% extends "clinic/base.html" %}
{% load static %}

{% block title %}
{% if form.instance.pk %}
Editar Consulta - OdontoIA
{% else %}
Nova Consulta - OdontoIA
{% endif %}
{% endblock %}

{% block content %}
<h2 class="page-title text-center my-3">
    {% if form.instance.pk %}
        ‚úèÔ∏è Editar Consulta
    {% else %}
        ü¶∑ Agendar Nova Consulta
    {% endif %}
</h2>

<form method="post" class="container">
    {% csrf_token %}

    <div style="background:#fff; padding:20px; border-radius:12px; max-width:600px; margin:30px auto;
                box-shadow:0 2px 6px rgba(0,0,0,0.1);">

        {{ form.as_p }}

        <div class="mt-3 text-end">
            <button type="submit" class="btn btn-primary">üíæ Salvar</button>
            <a href="{% url 'clinic:consultas_list' %}" class="btn btn-secondary">Cancelar</a>
        </div>
    </div>
</form>

<style>
    h2 {
        color: #0b5394;
    }

    .btn-primary {
        background-color: #0b5394;
        border: none;
    }

    .btn-primary:hover {
        background-color: #083b6b;
    }
</style>

<!-- AUTO-PREENCHER VALOR DO PROCEDIMENTO -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    const procedimentoSelect = document.querySelector("select[name='procedimento']");
    const valorInput = document.querySelector("input[name='valor']");

    if (!procedimentoSelect || !valorInput) return;

    procedimentoSelect.addEventListener("change", () => {
        const procedimentoId = procedimentoSelect.value;

        if (!procedimentoId) {
            valorInput.value = "";
            return;
        }

        fetch(`/procedimentos/${procedimentoId}/valor/`)
            .then(response => response.json())
            .then(data => {
                valorInput.value = data.valor;
            });
    });

});
</script>

{% endblock %}

<style>
    h2 {
        color: #0b5394;
    }

    .btn-primary {
        background-color: #0b5394;
        border: none;
    }

    .btn-primary:hover {
        background-color: #083b6b;
    }
</style>

{% endblock %}